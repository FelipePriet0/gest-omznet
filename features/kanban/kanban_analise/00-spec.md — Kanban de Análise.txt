### ğŸ¯ Objetivo

Orquestrar o fluxo de anÃ¡lise das fichas enviadas pelo Comercial, garantindo atribuiÃ§Ã£o correta, controle de status, rastreabilidade e automaÃ§Ãµes de notificaÃ§Ã£o e histÃ³rico.

---

### âœ… Resultado Esperado (DONE = Verdadeiro quandoâ€¦)

- [ ]  Cards de **ConcluÃ­das (Comercial)** aparecem automaticamente em **Recebidos (AnÃ¡lise)**.
- [ ]  O botÃ£o **Ingressar** atribui o Analista e move o card para **Em AnÃ¡lise**.
- [ ]  Pareceres (Aprovado, Negado, ReanÃ¡lise) funcionam conforme regras por coluna.
- [ ]  Movimentos para **Canceladas** exigem motivo.
- [ ]  Cards em **Finalizados** sÃ£o enviados para **HistÃ³rico** apÃ³s 5 minutos.
- [ ]  Sidebar Superior: Filtros de topo (Setor, ResponsÃ¡vel, Prazo, AtribuÃ­das) retornam resultados corretos.

### ğŸ” Fluxo Simplificado

1ï¸âƒ£ Comercial conclui o card â†’ Trigger envia para **AnÃ¡lise/Recebidos**.

2ï¸âƒ£ Analista clica **Ingressar** â†’ vira responsÃ¡vel e o card vai para **Em AnÃ¡lise**.

3ï¸âƒ£ Analista aplica **Parecer (Aprovado, Negado, ReanÃ¡lise)** â†’ move de coluna conforme o status.

4ï¸âƒ£ Pode mover para **Ass App** â†’ cria tarefa e agenda notificaÃ§Ãµes.

5ï¸âƒ£ Mover para **Finalizados** â†’ apÃ³s 5min â†’ vai para **HistÃ³rico**.

6ï¸âƒ£ Mover para **Canceladas** â†’ abre modal â†’ exige motivo â†’ registra auditoria.

### ğŸš« Filtros avanÃ§ados  (Side bar superior). 
****

| Filtros | Funcionalidade | O que Ã©:  |
| --- | --- | --- |
| Busca | Buscar o nome do titular da ficha/cadastro | Barra de busca com Placeholder: â€Buscar Titular (Nome da ficha)â€ |
| Setor | Segmentar o kanban por setores, podendo navegar por pÃ¡ginas diferentes e deixar o front organizado) | Dropdown com: 

 - Comercial â†’ Action: Vai para aba /kanban comercial
- Analise â†’ Action: Vai para aba /Analise Comercial |
| ResponsÃ¡vel |  Filtrar o Colaborador responsÃ¡vel por aquela ficha. 

OBS: No kanban AnÃ¡lise, responsÃ¡vel sÃ£o apenas os Analistas. 

 | Dropdown com Hook em: 

- [`Public.profiles.id](http://Public.profiles.id) e public.role.id`

Todo id que a role for: â€œAnalistaâ€ deve ter o public.profiles.Full_name no dropdown.  |
| **Prazo** | **Filtrar as fichas do dia escolhido, fazendo a comparaÃ§Ã£o com:** 

`- public.kanban_cards.due_at`
 | Dropdown com: 

- **Todos 
- Agendada para hoje 
- Agendada para amanhÃ£ 
- Atrasado 
- Escolher data 

OBS: Ao selecionar â€œEscolher Dataâ€ abre calendÃ¡rio (Biblioteca: Flatpickr) na tela para escolha da â€œDataâ€: Dia / MÃªs / Ano.**  |
| **HorÃ¡rio** | Escolher data de agendamento, baseado em: 

`- public.kanban_cards.due_at
 - public.kanban_cards.hora_at` | Dropdown com: 

- 08:30
- 10:30
- 13:30
- 15:30  |
| **Atribuidas** | Filtrar os cards que tem â€œMenÃ§Ãµesâ€ ou â€œTarefasâ€ (Depende da escolha) referentes ao ID. 
 | Dropdown com: 

- Todos
- Minhas MenÃ§Ãµes
- Minhas tarefas |

### ğŸ§± Colunas do Kanban

| Coluna | DescriÃ§Ã£o | Acesso |
| --- | --- | --- |
| **Recebidos** |  â€œporta de entradaâ€ do Kanban de AnÃ¡lise. Aqui caem as fichas que foram enviadas pelo Comercial pela coluna: ConcluÃ­das.

TambÃ©m e a Coluna onde os cards ganham o CTA: â€œIngressarâ€ no canto inferior esquerdo, permitidindo os Analistas e Gestores ingressarem (O que gera um Hook com backend EM Assignee id e atrela a ficha/card para o analista) | analistas/gestores. O primeiro passo Ã© â€œIngressarrâ€ na ficha (assumir responsabilidade), e assim, automaticamente Ã©  movida  para coluna â€œEm AnÃ¡liseâ€

OBS: Caso alguÃ©m queira mover uma ficha com analista jÃ¡ atribuido para essa coluna: 

â€¢ Se a ficha jÃ¡ tiver responsÃ¡vel, abrir um Modal de aviso: Essa ficha possui responsÃ¡vel atribuido, movÃª-la para essa coluna irÃ¡ desatribui-lo do card. Tem certeza que deseja mover?.
CTA: Cancelar (Cinza) â†’ Cancela, fecha o modal e mantÃªm a ficha na mesma coluna
Sim, tenho certeza â†’ Move para coluna: Recebidos. fecha o Modal, desatribui o colaborador antigo (Assigne), deixando o campo analista em branco.
â€¢ Isso libera o CTA: â€œIngressarâ€ de aparecer e seguir o fluxo do mesmo, redatado abaixo: 

**BotÃ£o â€œIngressarâ€ : Posicionado no canto inferior esquerdo do card:**
â€¢ Para que serve: Colaborador assume a anÃ¡lise da ficha, automaticamente a ficha move para a coluna (3.2.2): â€œEm anÃ¡liseâ€ ao lado, e o colaborador Ã© relacionado como Analista daquela ficha, em â€œEditar Fichaâ€, campo: â€œAnalistaâ€.
â€¢ Onde aparece:  Canto inferior esquerdo, dentro do cards na coluna: â€œRecebidosâ€ (Kanban de AnÃ¡lise).
â€¢ O que faz ao clicar:
â€¢ Move a ficha para â€œEm AnÃ¡liseâ€.
â€¢ Define vocÃª como responsÃ¡vel (assignee).
â€¢ Registra a aÃ§Ã£o (quem/quando) para auditoria.
â€¢ ObservaÃ§Ãµes:

    â—¦ Se vocÃª nÃ£o tiver permissÃ£o (Auth), o sistema bloqueia e exibe aviso: â€œVocÃª nÃ£o tem permissÃ£o para essa aÃ§Ã£oâ€. |
| **Em AnÃ¡lise** |  coluna onde ficam as fichas que jÃ¡ foram assumidas (via â€œIngressarâ€) e estÃ£o sendo trabalhadas pelo analista. | analistas/gestores  podem movimentar para dentro fora desta coluna conforme o andamento do trabalho  |
| **ReanÃ¡lise** | O que Ã©: coluna para fichas que precisam de nova avaliaÃ§Ã£o apÃ³s pendÃªncias, documentos adicionais ou mudanÃ§as de cenÃ¡rio. |  analista atribuido (Assignee) e gestores  pode movimentar para dentro fora desta coluna conforme o andamento do trabalho  

Nessa coluna, a funÃ§Ã£o /reanalise Ã© desativada (Ficando em cor de desativada no dropdown), modele grandes softwares para fzer isso aqui, quando uma funÃ§Ã£o estÃ¡ bloqueada eles a deixam meio que apagadas. 

Aprovado e /Negado estÃ¡ ativado dentro do parecer e acionando o Card Ã© movido para a respectiva coluna (/Aprovado â†’ Coluna: â€œAprovadoâ€ ; /Negado â†’ Coluna: â€œNegadoâ€).  |
| **Aprovados** | coluna para fichas que passaram nos critÃ©rios da AnÃ¡lise e estÃ£o autorizadas a seguir (instalaÃ§Ã£o/ativaÃ§Ã£o/cadastro final, conforme o processo). | analista atribuido (Assignee) e gestores  podem movimentar para dentro fora desta coluna conforme o andamento do trabalho   |
| **Negados** | coluna para fichas que foram negadas | analista atribuido (Assignee) e gestores  podem movimentar para dentro fora desta coluna conforme o andamento do trabalho    |
| **Canceladas** | coluna onde ficam as fichas encerradas por desistÃªncia, erro definitivo ou inviabilidade comprovada.  | nalista atribuido (Assignee)  e Gestores  podem movimentar, apenas para dentro, desta coluna conforme o andamento  e quem movimenta precisa informar um motivo (obrigatÃ³rio). O sistema registra quem cancelou (`public.kanban_card.cancelled_by`) e quando (`public.kanban_card.cancel_reason`).  

**Modal â€œCancelar Fichaâ€:**
â€¢ Quando vocÃª arrasta uma ficha para a coluna â€œCanceladasâ€, o sistema abre um modal pedindo o motivo do cancelamento.
    â—¦ O motivo Ã© obrigatÃ³rio. Sem motivo, a ficha nÃ£o Ã© cancelada.
<aside>
ğŸ’¡
Estrutura do Modal
    â—¦ TÃ­tulo: â€œCancelar fichaâ€
    â—¦ SubtÃ­tulo: â€œInforme o motivo do cancelamento. Esta aÃ§Ã£o serÃ¡ registrada para anÃ¡lise.â€
    â—¦ Campo â€œMotivoâ€ (obrigatÃ³rio):

        â–ª Campo de texto curto (uma frase direta).
        â–ª Placeholder: â€œEx: Cliente desistiu / Dados inconsistentesâ€

ğŸ’¡
    â—¦ RodapÃ© (botÃµes/CTAs):

        â–ª â€œCancelarâ€ (cinza): fecha o modal sem fazer nada; a ficha permanece como estava.
        â–ª â€œConfirmarâ€ (verde): confirma o cancelamento, move a ficha para â€œCanceladasâ€ e salva o motivo.

ğŸ’¡
Regras e Comportamento
    â—¦ Motivo obrigatÃ³rio: se o campo estiver vazio, aparece um aviso e o cancelamento nÃ£o segue.
    â—¦ Registro (auditoria): o sistema grava quem cancelou, quando e qual motivo foi informado.
    â—¦ Efeito no Kanban: ao confirmar, a ficha vai para â€œCanceladasâ€. A lista atualiza automaticamente.
    â—¦ Sem â€œapagarâ€: cancelar nÃ£o apaga a ficha; ela fica registrada no histÃ³rico para consultas futuras.
 |
| **Ass App** | Coluna cujo os Aprovados vÃ£o para que possamos gerenciar as ass App que estÃ£o PENDENTES.  | analista atribuido (Assignee) e gestores  podem movimentar para dentro ou fora (Dentro do prazo do trigger) desta coluna conforme o andamento do trabalho     
 |
| **Finalizados** |  Estado final do Kanban de AnÃ¡lise. A ficha concluiu o ciclo de anÃ¡lise (e, se aplicÃ¡vel, os passos seguintes) sem pendÃªncias. |  analista atribuido (Assignee) e gestores  pode movimentar para dentro ou fora (Dentro do prazo do trigger) desta coluna conforme o andamento do trabalho    

Trigger da coluna: ApÃ³s 5 minutos do card enviado para essa coluna, envia-o para HistÃ³rico.  |