### Inbox:

### Funcionalidade: Caixa de Entrada (Painel de NotificaÃ§Ãµes)

ğŸ¯ **Objetivo**

Centralizar todas as notificaÃ§Ãµes operacionais do sistema â€” tarefas, conversas, menÃ§Ãµes e fichas â€” em um Ãºnico local intuitivo e funcional, para que o colaborador saiba **exatamente o que precisa fazer** e **mantenha o fluxo de trabalho em dia**.

ğŸ’¬ â€œAqui vocÃª encontra tudo o que precisa fazer no seu dia!!

Mantenha a caixa vazia ao final do expediente â€” isso Ã© sinal de produtividade!â€

Para deixar tudo mais organizado e objetivo, separamos em dois tipos de notificaÃ§Ãµes: 

- As Permanentes (Tarefas, MenÃ§Ãµes, Anexos)
- As de Aviso (Desaparecem) (Prazos, etc)

---

### ğŸ§± **Estrutura da Interface**

A Caixa de Entrada serÃ¡ uma **aba lateral retrÃ¡til**, acessada pelo Ã­cone de ğŸ”” no canto superior direito da tela.

Ao clicar, abrirÃ¡ um **painel lateral fixo** (tipo *drawer*), dividido em trÃªs seÃ§Ãµes principais:

---

### **1. CabeÃ§alho**

| Elemento | FunÃ§Ã£o |
| --- | --- |
| **TÃ­tulo:** Caixa de Entrada (ğŸ””) -Em flutter (Quero deixar o UI bem bonito).  | Nome da funcionalidade |
| **Contador:** `(7)` | Exibe o nÃºmero de notificaÃ§Ãµes  |
| CTA: Ao clicar em cima da notificaÃ§Ã£o direciona para o evento de criaÃ§Ã£o da mesma.   | Controle de organizaÃ§Ã£o e objetividade |

---

### ğŸ§© **Eventos que Geram NotificaÃ§Ãµes**

- ğŸ“‹ Tarefas cujo colaborador foi mencionado.
- ğŸ’¬ Conversas e threads com menÃ§Ãµes diretas.
- ğŸ“£ Qualquer menÃ§Ã£o usando `@usuario`.
- â° Tarefas prÃ³ximas do vencimento (â€œEiii! A tarefa *X* estÃ¡ agendada para *XX/XX Ã s 00:00*! Corre pra nÃ£o atrasar!â€). (Mensagem informativa, some depois de algum tempo).
- ğŸ”¥ Fichas atrasadas (â€œVocÃª tem X fichas pendentes ğŸ”¥ â€” priorize-as.â€).  (4 em 4 horas gera 1 notificaÃ§Ã£o e Para as que tem foguinho na coluna â€œAss Appâ€ geram apenas 1 notificaÃ§Ã£o).  - OBS: NotificaÃ§Ã£o gerada apenas para: â€œAnalistasâ€ e â€œGestoresâ€ cujo ficha estÃ¡ atribuida (Assignee id)

---

### ğŸ¨ Estrutura de mensagem de cada evento que gera notifcaÃ§Ã£o

| Tipo | Ãcone | Estrutura da Mensagem |
| --- | --- | --- |
| ğŸ’¬ Conversa | ğŸ’¬ | â€œ@MarceloAnÃ¡lise mencionou vocÃª no Card JoÃ£o Soares, veja agoraâ€  |
| ğŸ“‹ Tarefa | ğŸ“‹ | â€œVocÃª tem uma tarefa agendada para hoje Ã s 16h: Reagendar InstalaÃ§Ã£o.â€ |
| ğŸš€ Nova Ficha | ğŸš€ | â€œNova ficha disponÃ­vel: Felipe GonÃ§alves Prieto.â€ |
| ğŸ”¥ Atraso | ğŸ”¥ | â€œVocÃª possui 3 fichas pendentes ğŸ”¥ Priorize-as.â€ |
| ğŸ˜… Disputa | ğŸ˜… | â€œPoooxa, o colaborador Pedro foi mais rÃ¡pido!â€ |
| Resposta  |  |  |

---

### ğŸ§© PriorizaÃ§Ã£o das mensagens

---

### ğŸ§­ **IntegraÃ§Ãµes com Outras Ãreas do Sistema**

| Origem | InteraÃ§Ã£o |
| --- | --- |
| **Tarefas** | Vincula o item da notificaÃ§Ã£o Ã  tabela de tarefas |
| **Conversas** | Integra diretamente com a thread/comentÃ¡rio onde houve a menÃ§Ã£o. |
| **Fichas** | ReferÃªncia  e status do cadastro (entrada, atraso, disputa). |
| **Supabase Realtime** | Atualiza notificaÃ§Ãµes em tempo real (novas menÃ§Ãµes, novas fichas, mudanÃ§as de status). |

---

### ğŸ§© **Futuras EvoluÃ§Ãµes**

- Filtro â€œSomente nÃ£o vistas hojeâ€.
- Pesquisa por nome de tarefa, card ou ficha dentro da caixa.
- Atalho de teclado (ex: `Alt + N`) para abrir a aba lateral rapidamente.
- Indicador de prioridade flutuante (badge colorido ao lado do sino).
- OpÃ§Ã£o â€œLembrar mais tardeâ€ para reagendar notificaÃ§Ãµes.

---

ğŸ—„ï¸ Backend - Estrutura do Banco

### ğŸ“Š Tabela Principal: `inbox_notifications`

## **Colunas EspecÃ­ficos e Seus Usos**

**ğŸ“‹Â CamposÂ de IdentificaÃ§Ã£o**

| Campo | Tipo | Nullable | DescriÃ§Ã£o |
| --- | --- | --- | --- |
| id | uuid | âŒ | Identificador Ãºnico da notificaÃ§Ã£o |
| user_id | uuid | âŒ | UsuÃ¡rio destinatÃ¡rio (FK) |
| applicant_id | uuid | âœ… | Cliente relacionadoÂ (FK) |

**ğŸ“Â Campos de ConteÃºdo**

| Campo | Tipo | DescriÃ§Ã£o |
| --- | --- | --- |
| title | text | TÃ­tulo da notificaÃ§Ã£o |
| body | text | Corpo/descriÃ§Ã£o daÂ notificaÃ§Ã£o |
| meta | jsonb | Metadados extras (dados flexÃ­veis) |

**ğŸ”—Â Campos de Relacionamento**

| Campo | Tipo | Nullable | Relaciona com |
| --- | --- | --- | --- |
| task_id | uuid | âœ… | Tabela de tarefas |
| card_id | uuid | âœ… | public.kanban_cards(id) |
| comment_id | uuid | âœ… | ComentÃ¡rio relacionado |

**âš™ï¸Â Campos de Controle**

| Campo | Tipo | DescriÃ§Ã£o |
| --- | --- | --- |
| type | enum | Tipo da notificaÃ§Ã£o |
| priority | enum | Prioridade (high/medium/low) |
| transient | boolean | Se Ã©Â temporÃ¡ria |
| expires_at | timestamptz | Data de expiraÃ§Ã£o |
| read_at | timestamptz | Quando foiÂ lida |
| link_url | text | URL opcional |

**ğŸ•’Â Campos de Timestamp**

| Campo | Tipo | DescriÃ§Ã£o |
| --- | --- | --- |
| created_at | timestamptz | Data de criaÃ§Ã£o |
| updated_at | timestamptz | Data de Ãºltima atualizaÃ§Ã£o |

ğŸ”— Relacionamentos (Foreign Keys)

| Campo | ReferÃªncia | Tabela | DescriÃ§Ã£o |
| --- | --- | --- | --- |
| `user_id` | `profiles.id` | `public.profiles` | UsuÃ¡rio destinatÃ¡rio |
| `applicant_id` | `applicants.id` | `public.applicants` | Cliente relacionado |

**ğŸ”— Relacionamentos Detalhados**

**1ï¸âƒ£Â user_idÂ â†’Â public.profiles(id)**

<aside>
ğŸ’¡

user_id uuid NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE

</aside>

- **O que Ã©:**Â ID do usuÃ¡rio destinatÃ¡rio da notificaÃ§Ã£o
- **Relacionamento:**Â 1 para muitos (1 usuÃ¡rioÂ pode ter vÃ¡rias notificaÃ§Ãµes)
- **AÃ§Ã£o:**Â CASCADE (se usuÃ¡rio for deletado, suasÂ notificaÃ§ÃµesÂ sÃ£o removidas)
- **Uso:**Â Determina quem recebe a notificaÃ§Ã£o

**2ï¸âƒ£Â card_idÂ â†’Â public.kanban_cards(id)**

<aside>
ğŸ’¡

card_id uuid NULL REFERENCES public.kanban_cards(id) ON DELETE SET NULL

</aside>

- **O que Ã©:**Â IDÂ do card do Kanban relacionado
- **Relacionamento:**Â 1 para muitos (1 card pode gerar vÃ¡rias notificaÃ§Ãµes)
- **AÃ§Ã£o:**Â SET NULL (se card for deletado, card_id fica NULL)
- **Uso:**Â NotificaÃ§Ãµes sobre fichas especÃ­ficas

**3ï¸âƒ£Â applicant_idÂ â†’Â public.applicants(id)**

<aside>
ğŸ’¡

applicant_id uuid NULL REFERENCES publ

</aside>

- **O que Ã©:**Â ID do cliente/solicitanteÂ relacionado
- **Relacionamento:**Â 1 para muitos (1 cliente pode terÂ vÃ¡rias notificaÃ§Ãµes)
- **AÃ§Ã£o:**Â Sem aÃ§Ã£o especÃ­ficaÂ (nullable)
- **Uso:**Â NotificaÃ§Ãµes sobreÂ clientes especÃ­ficos

ğŸ”’ PolÃ­ticas RLS (Row Level Security)

 - UsuÃ¡rio sÃ³ vÃª suas prÃ³prias notificaÃ§Ãµes 
 - UsuÃ¡rio sÃ³ pode atualizar suas notificaÃ§Ãµes 
 - UsuÃ¡rio sÃ³ pode deletar suas notificaÃ§Ãµes