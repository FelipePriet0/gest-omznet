# **ğŸ—‘ï¸Â Soft Delete: O que Ã©Â e como funciona**

>Â **Para:**Â Toda a equipe (incluindo comercial)

>Â **Objetivo:**Â Entender como funciona aÂ "exclusÃ£o inteligente" no sistema

>Â **Ãšltima atualizaÃ§Ã£o:**Â JaneiroÂ 2025

---

## **ğŸ¤”Â O que Ã© SoftÂ Delete?**

<aside>

ğŸ’¡Â **EmÂ linguagem simples:**

Soft DeleteÂ Ã© quando vocÃª "apaga" algoÂ no sistema, mas na verdade eleÂ **continua salvo no banco de dados**, sÃ³ fica invisÃ­vel.

Ã‰Â como colocar um arquivo naÂ **Lixeira do Windows**Â em vez de deletarÂ permanentemente. VocÃª nÃ£o vÃª mais, mas ele ainda estÃ¡ lÃ¡ eÂ pode ser recuperado.

</aside>

---

## **ğŸ†šÂ Soft Delete vs Hard Delete**

**Hard Delete (ExclusÃ£o Permanente)VocÃªÂ clicaÂ emÂ "Excluir"Â â†’Â OÂ registroÂ Ã©Â DELETADOÂ DOÂ BANCOÂ â†’Â PerdeuÂ foreverÂ âŒ**

**Problemas:**

- âŒ NÃ£o temÂ como desfazer
- âŒ NÃ£o sabe quem deletou
- âŒ NÃ£o sabe quando foi deletado
- âŒ Perde dados para auditoria
- âŒ Se foi erro, nÃ£o tem como recuperar

---

**Soft Delete (ExclusÃ£o Inteligente)VocÃªÂ clicaÂ emÂ "Excluir"Â â†’Â OÂ registroÂ Ã©Â MARCADOÂ comoÂ deletadoÂ â†’Â FicaÂ invisÃ­velÂ âœ…**

**Vantagens:**

- âœ… Pode desfazer se precisar
- âœ… Sabe quem deletou e quando
- âœ… MantÃ©m histÃ³rico completo
- âœ… Auditoria total
- âœ… RecuperaÃ§Ã£o possÃ­vel

---

## **ğŸ“ŠÂ Onde iremos implantar o Soft Delete?**

<aside>

ğŸ¯Â 1Â **funcionalidades principais usam Soft Delete:**

</aside>

### **1.Â ğŸ’¬ Cards e Fichas**

- **Tabela:**Â kanban_cards â€”> Quando um card Ã© apagado, fazer Cascade de Soft delete em: Public. Applicants + Public.PF_fichas e Public.PJ_fichas . Assim, os dados de toda a ficha Ã© Soft Excluido.
- **Onde:**Â Todas as conversas e pareceres nas fichas
- **Exemplo: Colaborador deleta card na aba de kanban = Todos os dados de Expanded ficha (Que sÃ£o os dados de cadastro tem que ser SOFT DELETADOS tambÃ©m).**

---

## **ğŸ”§Â Como podemos fazer para funcionar tecnicamente, mantendo a estrutura abaixo e dentro de um prazo de Limpeza AutomÃ¡tica: 90 Dias?**

```tsx
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CRIADO    â”‚ (deleted_at = NULL)
â”‚             â”‚ VisÃ­vel no sistema âœ…
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ UsuÃ¡rio clica "Excluir"
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DELETADO   â”‚ (deleted_at = "2025-01-15")
â”‚ (Soft)      â”‚ InvisÃ­vel no sistema âŒ
â”‚             â”‚ Mas ainda no banco ğŸ“‹
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ [Opcional] Gestor restaura
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESTAURADO  â”‚ (deleted_at = NULL novamente)
â”‚             â”‚ VisÃ­vel no sistema âœ…
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ ApÃ³s 90 dias deletado
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REMOVIDO   â”‚ Deletado PERMANENTEMENTE
â”‚(Permanente) â”‚ Sai do banco de dados ğŸ—‘ï¸
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## **ğŸ“…Â Limpeza AutomÃ¡tica: 90 Dias**

âš ï¸Â **AtenÃ§Ã£o:**

Depois deÂ **90 dias**Â deletado (soft), o registro Ã©Â **deletado permanentemente**Â (hard) de forma automÃ¡tica.

### **Por queÂ 90 dias?**

- Tempo suficiente para auditorias
- Tempo suficiente para desfazer erros
- Evita acÃºmulo infinito de dadosÂ deletados
- MantÃ©m bancoÂ de dados performÃ¡tico

**Como funciona?**

```tsx
Sistema roda limpeza automÃ¡tica todo dia Ã s 3h da manhÃ£

Procura registros onde:
deleted_at < HOJE - 90 dias

Exemplo:
- Hoje: 15/04/2025
- Registro deletado em: 10/01/2025
- Tempo deletado: 95 dias
- AÃ§Ã£o: DELETAR PERMANENTEMENTE
```

## **ğŸ”Â LogÂ de Auditoria: Rastreando Tudo**

ğŸ“‹Â **Tabela Especial:Â deletion_log**

TodaÂ vez que algo Ã© deletadoÂ (soft delete), oÂ sistema cria um registro de auditoria.

**OÂ que Ã© registrado?**

```tsx
deletion_log:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id: "log-001"                            â”‚
â”‚ table_name: "card_attachments"           â”‚ â† Qual tabela
â”‚ record_id: "attach-123"                  â”‚ â† Qual registro
â”‚ deleted_by: "user-456"                   â”‚ â† Quem deletou
â”‚ deleted_at: "2025-01-15 14:30:00"        â”‚ â† Quando
â”‚ record_snapshot: { ... }                 â”‚ â† Backup completo!
â”‚ reason: "Anexo errado"                   â”‚ â† Motivo (opcional)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Sistema â†’ Aguarda 700ms â†’ UsuÃ¡rio para de digitar?